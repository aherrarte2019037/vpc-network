graph TB
    Internet((Internet))
    
    subgraph GCP["Google Cloud Platform - Proyecto Redes"]
        subgraph VPC["VPC: vpc-network<br/>10.0.0.0/16"]
            Router[Cloud Router<br/>main-router]
            NAT[Cloud NAT<br/>main-nat]
            
            subgraph DMZ["DMZ / Visitas<br/>10.0.0.0/26<br/>10.0.1.0/24"]
                DMZ_GW[Gateway]
                WebServer["üåê Web Server P√∫blico<br/>Apache2<br/>HTTP:80 / HTTPS:443<br/>IP: 10.0.1.2<br/>IP Ext: 34.63.41.144"]
            end
            
            subgraph Ventas["Subred de Ventas<br/>10.0.0.64/27"]
                V_GW[Gateway]
                VentasVM["üíª test-ventas-vm<br/>SSSD/LDAP Client<br/>SNMP Enabled"]
            end
            
            subgraph TI["Subred de TI<br/>10.0.0.96/27"]
                T_GW[Gateway]
                TIVM["üíª test-ti-vm<br/>SSSD/LDAP Client<br/>SNMP Monitoring Station<br/>SSH Public"]
            end
            
            subgraph DC["Subred de Data Center<br/>10.0.0.128/28"]
                DC_GW[Gateway]
                DNSServer["üåê DNS Server<br/>BIND9<br/>dns.x.local<br/>IP: 10.0.0.137<br/>SNMP Enabled"]
                LDAPServer["üîê LDAP Server<br/>OpenLDAP<br/>ldap.x.local<br/>IP: 10.0.0.131<br/>SNMP Enabled"]
                RRHHServer["üåê RRHH Web Server<br/>Apache2<br/>rrhh.x.local<br/>IP: 10.0.0.133<br/>SNMP Enabled"]
            end
            
            FW["üõ°Ô∏è Firewall Rules<br/>Fase 2 + Fase 3<br/>‚Ä¢ DNS, LDAP, SSH<br/>‚Ä¢ HTTP/HTTPS DMZ<br/>‚Ä¢ SNMP desde TI<br/>‚Ä¢ Bloqueo visitas"]
        end
    end
    
    %% Conexiones desde Internet
    Internet -->|"HTTP/HTTPS<br/>(Puertos 80/443)"| WebServer
    Internet -.->|"Bloqueado<br/>(Excepto DMZ)"| Ventas
    Internet -.->|"Bloqueado<br/>(Excepto DMZ)"| TI
    Internet -.->|"Bloqueado<br/>(Excepto DMZ)"| DC
    
    %% NAT y Router
    NAT <--> Router
    Router <--> DMZ
    Router <--> Ventas
    Router <--> TI
    Router <--> DC
    
    %% Control de Firewall
    FW -.->|"Controla<br/>Tr√°fico"| DMZ
    FW -.->|"Controla<br/>Tr√°fico"| Ventas
    FW -.->|"Controla<br/>Tr√°fico"| TI
    FW -.->|"Controla<br/>Tr√°fico"| DC
    
    %% Conexiones permitidas entre subredes
    VentasVM <-->|"Comunicaci√≥n<br/>Permitida"| TIVM
    VentasVM <-->|"Autenticaci√≥n<br/>LDAP"| LDAPServer
    TIVM <-->|"Acceso<br/>Permitido"| DNSServer
    TIVM <-->|"Acceso<br/>Permitido"| LDAPServer
    TIVM <-->|"Acceso<br/>Permitido"| RRHHServer
    
    %% Monitoreo SNMP (solo desde TI)
    TIVM -->|"SNMPv3<br/>UDP:161<br/>Permitido"| DNSServer
    TIVM -->|"SNMPv3<br/>UDP:161<br/>Permitido"| LDAPServer
    TIVM -->|"SNMPv3<br/>UDP:161<br/>Permitido"| RRHHServer
    TIVM -->|"SNMPv3<br/>UDP:161<br/>Permitido"| VentasVM
    
    %% Conexiones bloqueadas
    VentasVM -.->|"SNMP<br/>Bloqueado"| DNSServer
    VentasVM -.->|"SNMP<br/>Bloqueado"| LDAPServer
    VentasVM -.->|"SNMP<br/>Bloqueado"| RRHHServer
    WebServer -.->|"Acceso<br/>Bloqueado"| Ventas
    WebServer -.->|"Acceso<br/>Bloqueado"| TI
    WebServer -.->|"Acceso<br/>Bloqueado"| DC
    
    %% Servicios DNS internos
    VentasVM -->|"DNS Query<br/>TCP/UDP:53"| DNSServer
    TIVM -->|"DNS Query<br/>TCP/UDP:53"| DNSServer
    RRHHServer -->|"DNS Query<br/>TCP/UDP:53"| DNSServer
    LDAPServer -->|"DNS Query<br/>TCP/UDP:53"| DNSServer
    
    %% VPN (cuando est√© implementada)
    VPN_Note["üîí VPN Server<br/>(Pendiente)<br/>Autenticaci√≥n LDAP<br/>OpenVPN/WireGuard"]
    VPN_Note -.->|"Futuro<br/>LDAP Auth"| LDAPServer
    
    %% Estilos
    style VPC fill:#e1f5ff,stroke:#01579b,stroke-width:3px
    style DMZ fill:#ffeb3b,stroke:#f57f17,stroke-width:2px
    style Ventas fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style TI fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    style DC fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style Router fill:#b3e5fc,stroke:#0277bd
    style NAT fill:#b3e5fc,stroke:#0277bd
    style FW fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style Internet fill:#90caf9,stroke:#1565c0,stroke-width:2px
    style WebServer fill:#4caf50,stroke:#1b5e20,stroke-width:2px
    style DNSServer fill:#ff9800,stroke:#e65100,stroke-width:2px
    style LDAPServer fill:#ff9800,stroke:#e65100,stroke-width:2px
    style RRHHServer fill:#ff9800,stroke:#e65100,stroke-width:2px
    style TIVM fill:#2196f3,stroke:#0d47a1,stroke-width:2px
    style VentasVM fill:#81c784,stroke:#2e7d32
    style VPN_Note fill:#9e9e9e,stroke:#424242,stroke-width:2px,stroke-dasharray: 5 5

